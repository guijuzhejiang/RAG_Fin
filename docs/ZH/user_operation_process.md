# RAG系统用户操作流程

## 1. 文件上传与知识库构建阶段

### 1.1 知识库管理
- **创建知识库**：用户首先创建一个新的知识库（Knowledge Base，KB），设置名称、描述等基本信息
- **管理知识库**：用户可以查看、编辑或删除已有的知识库

### 1.2 文档处理
- **上传文件**：向已存在的知识库中上传文档文件（PDF、Word、TXT等格式）
- **解析文档**：对上传的文档进行处理和分析
  - **文本分块**：系统将上传的文档自动分割成适合处理的小块（chunks）
  - **向量生成**：使用embedding模型对每个文本块生成向量表示
  - **向量存储**：将生成的向量与对应的文本内容一起保存到知识库中

### 1.3 知识库维护
- **更新文档**：用户可以更新已有文档，系统会重新处理并更新对应的向量
- **删除文档**：用户可以从知识库中删除不再需要的文档
- **编辑文本分块**：用户可以编辑知识库中的文本分块内容
- **删除文本分块**：用户可以删除特定的文本分块
- **查看统计信息**：用户可以查看知识库中的文档数量、文本块数量等统计信息

## 2. 用户问答交互阶段

### 2.1 向量检索
- **问题向量化**：系统使用相同的embedding模型将用户问题转换为向量
- **相似度搜索**：在知识库中搜索与问题向量最相似的文本块向量
- **初步筛选**：获取相似度最高的一批（如top-k）文本块作为候选

### 2.2 结果优化
- **重排序处理**：使用rerank模型对候选文本块进行重新排序，提高相关性
- **上下文组装**：将重排序后的前n个最相关文本块组装成上下文

### 2.3 LLM回答生成
- **提示词构建**：将用户问题和上下文组合成提示词
- **答案生成**：使用LLM大模型基于提供的上下文生成回答
- **引用标注**：在回答中标注信息来源，提高可信度

### 2.4 对话管理
- **对话历史保存**：系统保存用户与RAG系统的对话历史
- **上下文延续**：在多轮对话中保持上下文连贯性
- **对话导出**：用户可以导出对话内容以便后续参考

## 3. 系统设置与优化

### 3.1 参数配置
- **向量搜索参数**：调整相似度阈值、返回结果数量等
- **分块参数**：调整文本块大小、重叠比例等
- **模型选择**：选择不同的embedding模型、rerank模型或LLM模型
